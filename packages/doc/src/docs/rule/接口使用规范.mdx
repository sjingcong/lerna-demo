# æ¥å£ä½¿ç”¨è§„èŒƒ

<div style={{
  position: 'fixed',
  top: '200px',
  left: '400px',
  backgroundColor: 'white',
  border: '1px solid #e1e5e9',
  borderRadius: '8px',
  padding: '12px',
  boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
  zIndex: 1000,
  fontSize: '14px',
  maxWidth: '200px'
}}>
  <div style={{ fontWeight: 'bold', marginBottom: '8px', color: '#1890ff' }}>ğŸ“‹ å¿«é€Ÿå¯¼èˆª</div>
  <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>
    <a href="#1-å®ä¾‹åŒ–httprequestå•ä¾‹" style={{ color: '#666', textDecoration: 'none' }}>ğŸ”§ å®ä¾‹åŒ–HttpRequest</a>
    <a href="#2-postæ–¹æ³•è°ƒç”¨" style={{ color: '#666', textDecoration: 'none' }}>ğŸ“¤ POSTæ–¹æ³•è°ƒç”¨</a>
    <a href="#3-getæ–¹æ³•è°ƒç”¨" style={{ color: '#666', textDecoration: 'none' }}>ğŸ“¥ GETæ–¹æ³•è°ƒç”¨</a>
    <a href="#4-configå‚æ•°è¯¦è§£" style={{ color: '#666', textDecoration: 'none' }}>âš™ï¸ configå‚æ•°è¯¦è§£</a>
    <a href="#5-é”™è¯¯å¤„ç†" style={{ color: '#666', textDecoration: 'none' }}>âŒ é”™è¯¯å¤„ç†</a>
    <a href="#6-æœ€ä½³å®è·µ" style={{ color: '#666', textDecoration: 'none' }}>âœ… æœ€ä½³å®è·µ</a>
    <a href="#7-æ³¨æ„äº‹é¡¹" style={{ color: '#666', textDecoration: 'none' }}>âš ï¸ æ³¨æ„äº‹é¡¹</a>
  </div>
</div>

æœ¬æ–‡æ¡£ä»‹ç»é¡¹ç›®ä¸­HTTPè¯·æ±‚çš„æ ‡å‡†ä½¿ç”¨æ–¹å¼å’Œé…ç½®è¯´æ˜ã€‚

## <span id="1-å®ä¾‹åŒ–httprequestå•ä¾‹">1. å®ä¾‹åŒ–HttpRequestå•ä¾‹</span>

åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å•ä¾‹æ¨¡å¼åˆ›å»ºHttpRequestå®ä¾‹ï¼Œç¡®ä¿å…¨å±€ç»Ÿä¸€çš„é…ç½®å’ŒçŠ¶æ€ç®¡ç†ã€‚

### authå‚æ•°çš„æ¥æº

é¦–å…ˆéœ€è¦ä»Pinia storeä¸­è·å–è®¤è¯ä¿¡æ¯ï¼š

```typescript
import { createPinia, defineStore } from 'pinia';
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate';

const store = createPinia();

// æŒä¹…åŒ–æ’ä»¶
store.use(piniaPluginPersistedstate);

const useAuthStore = defineStore('authStore', {
  state: () => ({
    accessToken: '11111', // è¿™é‡Œæ˜¯è°ƒç”¨ç™»å½•æ¥å£è·å¾—ï¼Œæˆ–è€…ä»è·³é“¾ä¸­æ‹¿åˆ°
    refreshToken: '22222', // è¿™é‡Œæ˜¯è°ƒç”¨ç™»å½•æ¥å£è·å¾—ï¼Œæˆ–è€…ä»è·³é“¾ä¸­æ‹¿åˆ°
  }),
  getters: {
    getTokenStore: state => {
      return state;
    },
  },
  actions: {},
  persist: {}, // å¯ç”¨æŒä¹…åŒ–å­˜å‚¨
});
```

### åˆ›å»ºHttpRequestå®ä¾‹

```typescript
import { HttpRequest } from '@giom/shared/tools/http-client';

// è·å–è®¤è¯storeå®ä¾‹
const authStore = useAuthStore();

// åˆ›å»ºHttpRequestå®ä¾‹
const httpInstance = new HttpRequest({
  enableLogging: true,
  auth: authStore, // æ¥è‡ªPinia storeçš„è®¤è¯ä¿¡æ¯
  baseUrl: '/',
  refreshTokenApi: '/auth/refreshToken', // tokenåˆ·æ–°æ¥å£
});
```

### é…ç½®å‚æ•°è¯´æ˜

- `enableLogging`: æ˜¯å¦å¯ç”¨æ—¥å¿—è®°å½•ï¼Œå»ºè®®å¼€å‘ç¯å¢ƒè®¾ä¸ºtrue
- `auth`: è®¤è¯é…ç½®å¯¹è±¡ï¼Œ**æ¥æºäºPinia store**ï¼ŒåŒ…å«accessTokenå’ŒrefreshTokenï¼Œæ”¯æŒæŒä¹…åŒ–å­˜å‚¨
- `baseUrl`: APIåŸºç¡€URLï¼Œé€šå¸¸è®¾ä¸º'/'
- `refreshTokenUrl`: Tokenåˆ·æ–°æ¥å£åœ°å€

### authé…ç½®çš„ç‰¹ç‚¹

1. **æŒä¹…åŒ–å­˜å‚¨**: é€šè¿‡`pinia-plugin-persistedstate`æ’ä»¶ï¼Œè®¤è¯ä¿¡æ¯ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
2. **å“åº”å¼æ›´æ–°**: å½“Tokenæ›´æ–°æ—¶ï¼Œstoreä¸­çš„æ•°æ®ä¼šè‡ªåŠ¨åŒæ­¥
3. **å…¨å±€å…±äº«**: å¤šä¸ªç»„ä»¶å¯ä»¥å…±äº«åŒä¸€ä»½è®¤è¯çŠ¶æ€
4. **è‡ªåŠ¨ç®¡ç†**: HttpRequestä¼šè‡ªåŠ¨å¤„ç†Tokençš„åˆ·æ–°å’Œæ›´æ–°

## <span id="2-postæ–¹æ³•è°ƒç”¨">2. POSTæ–¹æ³•è°ƒç”¨</span>

POSTæ–¹æ³•ç”¨äºåˆ›å»ºã€æ›´æ–°æ•°æ®æˆ–æ‰§è¡Œå¤æ‚æ“ä½œã€‚

### åŸºç¡€ç”¨æ³•

```typescript
// åŸºæœ¬POSTè¯·æ±‚
const response = await httpInstance.post('/api/users', {
  name: 'å¼ ä¸‰',
  email: 'zhangsan@example.com'
});

// å¸¦é…ç½®çš„POSTè¯·æ±‚
const response = await httpInstance.post('/api/users', userData, {
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});
```

### æ–¹æ³•ç­¾å

```typescript
post<T = any>(
  url: string,
  data?: any,
  config?: Partial<AxiosRequestConfig>
): Promise<T>
```

## <span id="3-getæ–¹æ³•è°ƒç”¨">3. GETæ–¹æ³•è°ƒç”¨</span>

GETæ–¹æ³•ç”¨äºè·å–æ•°æ®ï¼Œæ”¯æŒæŸ¥è¯¢å‚æ•°ã€‚

### åŸºç¡€ç”¨æ³•

```typescript
// åŸºæœ¬GETè¯·æ±‚
const users = await httpInstance.get('/api/users');

// å¸¦æŸ¥è¯¢å‚æ•°çš„GETè¯·æ±‚
const users = await httpInstance.get('/api/users', {
  page: 1,
  size: 10,
  status: 'active'
});

// å¸¦é…ç½®çš„GETè¯·æ±‚
const users = await httpInstance.get('/api/users', params, {
  timeout: 5000,
  responseType: 'json'
});
```

### æ–¹æ³•ç­¾å

```typescript
get<T = any>(
  url: string,
  params?: Record<string, any>,
  config?: Partial<AxiosRequestConfig>
): Promise<T>
```

## <span id="4-configå‚æ•°è¯¦è§£">4. configå‚æ•°è¯¦è§£</span>

configå‚æ•°æ˜¯å¯é€‰çš„é…ç½®å¯¹è±¡ï¼ŒåŸºäºAxiosçš„RequestConfigï¼Œæ”¯æŒä»¥ä¸‹å¸¸ç”¨é…ç½®ï¼š

### é€šç”¨é…ç½®

```typescript
interface RequestConfig {
  // è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  timeout?: number;
  
  // è¯·æ±‚å¤´
  headers?: Record<string, string>;
  
  // å“åº”ç±»å‹
  responseType?: 'json' | 'text' | 'blob' | 'arraybuffer';
  
  // é”™è¯¯å¤„ç†æ¨¡å¼
  errorMode?: 'toast' | 'modal' | 'hidden';
  
  // æ˜¯å¦ä¸ºåˆ·æ–°Tokenè¯·æ±‚
  isRefreshToken?: boolean;
}
```

### é…ç½®ç¤ºä¾‹

```typescript
// æ–‡ä»¶ä¸Šä¼ é…ç½®
const uploadConfig = {
  timeout: 30000,
  headers: {
    'Content-Type': 'multipart/form-data'
  },
  errorMode: 'toast'
};

// é™é»˜è¯·æ±‚é…ç½®ï¼ˆä¸æ˜¾ç¤ºé”™è¯¯æç¤ºï¼‰
const silentConfig = {
  errorMode: 'hidden'
};

// é•¿æ—¶é—´è¯·æ±‚é…ç½®
const longRequestConfig = {
  timeout: 60000,
  responseType: 'json'
};
```

## <span id="5-é”™è¯¯å¤„ç†">5. é”™è¯¯å¤„ç†</span>

HttpRequestå†…ç½®äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

- **Tokenè‡ªåŠ¨åˆ·æ–°**: å½“Tokenè¿‡æœŸæ—¶è‡ªåŠ¨åˆ·æ–°å¹¶é‡è¯•è¯·æ±‚
- **è¯·æ±‚é˜Ÿåˆ—ç®¡ç†**: Tokenåˆ·æ–°æœŸé—´çš„è¯·æ±‚ä¼šè¢«åŠ å…¥é˜Ÿåˆ—
- **é¢‘ç‡é™åˆ¶**: é˜²æ­¢çŸ­æ—¶é—´å†…é¢‘ç¹åˆ·æ–°Token
- **é”™è¯¯æç¤º**: æ”¯æŒtoastã€modalã€hiddenä¸‰ç§é”™è¯¯æ˜¾ç¤ºæ¨¡å¼

## <span id="6-æœ€ä½³å®è·µ">6. æœ€ä½³å®è·µ</span>

### ç±»å‹å®‰å…¨

```typescript
interface User {
  id: number;
  name: string;
  email: string;
}

// ä½¿ç”¨æ³›å‹ç¡®ä¿ç±»å‹å®‰å…¨
const user = await httpInstance.get<User>('/api/users/1');
const users = await httpInstance.get<User[]>('/api/users');
```

### é”™è¯¯å¤„ç†

```typescript
try {
  const result = await httpInstance.post('/api/users', userData);
  console.log('åˆ›å»ºæˆåŠŸ:', result);
} catch (error) {
  console.error('åˆ›å»ºå¤±è´¥:', error);
  // é”™è¯¯å·²ç”±HttpRequestå†…éƒ¨å¤„ç†ï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ é¢å¤–é€»è¾‘
}
```

### å–æ¶ˆè¯·æ±‚

```typescript
const controller = new AbortController();

const request = httpInstance.get('/api/users', {}, {
  signal: controller.signal
});

// 5ç§’åå–æ¶ˆè¯·æ±‚
setTimeout(() => {
  controller.abort();
}, 5000);
```

## <span id="7-æ³¨æ„äº‹é¡¹">7. æ³¨æ„äº‹é¡¹</span>

1. **å•ä¾‹ä½¿ç”¨**: ç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ªHttpRequestå®ä¾‹
2. **Tokenç®¡ç†**: authé…ç½®ä¼šè¢«è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨æ›´æ–°
3. **é”™è¯¯å¤„ç†**: å¤§éƒ¨åˆ†é”™è¯¯å·²å†…ç½®å¤„ç†ï¼Œç‰¹æ®Šæƒ…å†µæ‰éœ€è¦é¢å¤–å¤„ç†
4. **æ€§èƒ½ä¼˜åŒ–**: é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¤§é‡å¹¶å‘è¯·æ±‚
5. **ç±»å‹å®‰å…¨**: å»ºè®®ä½¿ç”¨TypeScriptæ³›å‹ç¡®ä¿ç±»å‹å®‰å…¨

é€šè¿‡éµå¾ªä»¥ä¸Šè§„èŒƒï¼Œå¯ä»¥ç¡®ä¿é¡¹ç›®ä¸­HTTPè¯·æ±‚çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚